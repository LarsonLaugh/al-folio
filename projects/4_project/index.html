<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>A genetic-algorithm optimized PID controller | Lixian Wang</title> <meta name="author" content="Lixian Wang"> <meta name="description" content="algorithm trained with simulated data from a physical model"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://larsonlaugh.github.io/projects/4_project/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Lixian </span>Wang</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">A genetic-algorithm optimized PID controller</h1> <p class="post-description">algorithm trained with simulated data from a physical model</p> </header> <article> <p>You may find a blog titled <a href="/blog/2022/pid/">“How to turn my kettle into a Sous vide cooker”</a> describing more details alongside this exploration.</p> <p>This personal project is to refactor my old kettle with a PID controller and its accessories to regulate water temperature below the boiling point like a Sous vide cooker. The line of thought on implementation is described in this chart:</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pidcontroller/PID%20workflow-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pidcontroller/PID%20workflow-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pidcontroller/PID%20workflow-1400.webp"></source> <img src="/assets/img/pidcontroller/PID%20workflow.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Let’s first go through some basics.</p> <h2 id="basics">Basics</h2> <h3 id="what-is-a-pid-controller">What Is a PID Controller?</h3> <p>A PID (Proportional-Integral-Derivative) controller is a widely used control loop feedback mechanism in industrial control systems. They are extensively utilized in processes where precise and stable control is essential, such as in temperature regulation in chemical plants, speed control in conveyor systems, and pressure control in oil refineries. Furthermore, PID controllers play a crucial role in automation, enhancing efficiency, and consistency in manufacturing processes, and are integral in emerging technologies within robotics and unmanned vehicles, where precise control is paramount. Their adaptability and accuracy make them an indispensable tool in the modern industrial landscape.</p> <h3 id="how-does-a-pid-controller-function">How Does a PID Controller Function?</h3> <p>At its core, a PID controller continuously calculates an error value as the difference between a desired setpoint and a measured process variable (temperature), subsequently applying a correction based on proportional, integral, and derivative terms. The proportional term determines the reaction to the current error, the integral term assesses the accumulation of past errors, and the derivative term predicts future errors, providing a smoother and more precise control method. This sophisticated balancing act makes PID controllers exceptionally versatile and effective in various industrial applications.</p> <h3 id="how-to-apply-genetic-algorithm-to-this-pid-controller">How to Apply Genetic Algorithm to This PID Controller?</h3> <p>Genetic Algorithms (GAs) are a type of evolutionary algorithm inspired by the process of natural selection, designed to solve complex optimization problems. In the context of a PID (Proportional-Integral-Derivative) controller, GAs can be particularly effective. They work by encoding the PID controller’s parameters (proportional, integral, and derivative gains) into a format akin to chromosomes, which are then subjected to processes mimicking biological evolution, such as selection, crossover, and mutation. Through iterative rounds of these processes, the genetic algorithm evolves a population of solutions, progressively improving the PID parameters to optimize the controller’s performance. This method is especially useful in complex systems where the optimal PID settings are not easily determinable due to nonlinearities or interactions between multiple variables.</p> <h2 id="implementation">Implementation</h2> <h3 id="01-physical-modeling">01. Physical Modeling</h3> <p>Heat transfer can take place in four different ways : <a href="https://en.wikipedia.org/wiki/Heat_transfer" rel="external nofollow noopener" target="_blank">Advection, thermal conduction, convection and radiation</a>. Here we only consider thermal conduction as the major contributor. We also consider metallic walls of the kettle to be perfectly transparent in terms of thermal conduction. Therefore, the hot water directly interfaces the cold air outside. In short, we estimate that the temperature goes up at a rate of <strong>0.3 deg/sec</strong> when the heater is on and decreases at a rate of <strong>0.012 deg/sec</strong> when off. Note that this estimate is not a function of temperature.</p> <h3 id="02-algorithm-training-process">02. Algorithm Training Process</h3> <p>The source code of this open-source project is hosted by <a href="https://github.com/LarsonLaugh/pidML" rel="external nofollow noopener" target="_blank">Github</a> .The same algorithm has been realized in both Python (<code class="language-plaintext highlighter-rouge">pidtrain.py</code>) and C++ (<code class="language-plaintext highlighter-rouge">pidtrain.cpp</code>). For comparison, C++ code is 50 times faster than its Python counterpart.</p> <h3 id="03-deployment-of-the-microcontroller">03. Deployment of the Microcontroller</h3> <p>The brain of the PID controller is a microcontroller (popular choices like Pi Pico and Ardurio Nano). A temperature sensor is inserted into the water to continuously monitor the temperature. And a relay is installed on the power line to execute on/off command from the microcontroller. For convenience, an user interface for manually setting up PID parameters is also implemented by a ICD 1602 screen and a rotary potentiometer. Below is a list of used hardware components:</p> <table> <thead> <tr> <th>Functional parts</th> <th>Models</th> </tr> </thead> <tbody> <tr> <td>Microcontroller</td> <td>Raspberry Pi Pico/ Ardurio Nano</td> </tr> <tr> <td>Temperature sensor</td> <td>MAX6675</td> </tr> <tr> <td>220V control</td> <td>Relay</td> </tr> <tr> <td>User interface</td> <td>ICD 1602</td> </tr> <tr> <td>User input</td> <td>rotary potentiometer</td> </tr> </tbody> </table> <p>Here is a diagram for wiring them:</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pidcontroller/sketch_ArduinoNano-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pidcontroller/sketch_ArduinoNano-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pidcontroller/sketch_ArduinoNano-1400.webp"></source> <img src="/assets/img/pidcontroller/sketch_ArduinoNano.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>The deploying code has also been realized in both Micropython and Ardurio for Pico and Ardurio Nano, respectively. The <code class="language-plaintext highlighter-rouge">Micropython</code> code for microcontroller unit (MCU) is stored in <code class="language-plaintext highlighter-rouge">mpython</code> folder. The Arduino code for MCU is stored in <code class="language-plaintext highlighter-rouge">Arduino</code> folder.</p> <h3 id="04-performance">04. Performance</h3> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pidcontroller/realvssimu-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pidcontroller/realvssimu-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pidcontroller/realvssimu-1400.webp"></source> <img src="/assets/img/pidcontroller/realvssimu.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <p>Here we show the actual temperature curve (labelled as “real”) and the simulation result (labelled as “simulation”) with the same PID parameters. In the first 2000 seconds, the simulation matches quite well with the actual curve in both trend of temperature (upper) and calculated output (<code class="language-plaintext highlighter-rouge">Kp*error+Ki*integral+Kd*derivative</code>) of the PID feedback loop (lower). That means our physical model estimates accurately the change rate of temperature used for training process. After 2000 seconds, the simulation attains a stabilization of temperature within 0.32 degree. In reality, the temperature continues to fluctuate in a narrowed window ~ 5 degrees in recorded time. This fluctuation seems to be overshooting, which may be due to the fact that the heater is still much hotter than water and continues to heat water even after being powered off. This may be the bottleneck to achieve better performance.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Lixian Wang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>